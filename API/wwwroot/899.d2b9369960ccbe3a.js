"use strict";(self.webpackChunkcourse_ui=self.webpackChunkcourse_ui||[]).push([[899],{9899:(St,G,r)=>{r.r(G),r.d(G,{ViewAdminComponent:()=>D,ViewAdminModule:()=>Ct});var t=r(5879),y=r(612),X=r(7293),N=r(8180),s=r(4221);function d(e,i){return`[Admin${"api"===i?"/API":i?"/Page":""}] ${e}`}const b=(0,s.PH)(d("Init","page")),W=(0,s.PH)(d("Load Users With Roles")),E=(0,s.PH)(d("Load Users With Roles Success","api"),(0,s.Ky)()),Z=(0,s.PH)(d("Load Users With Roles Failure","api"),(0,s.Ky)()),R=(0,s.PH)(d("Update User Roles","page"),(0,s.Ky)()),k=(0,s.PH)(d("Update User Roles Success","api"),(0,s.Ky)()),$=(0,s.PH)(d("Update User Roles Failure","api"),(0,s.Ky)()),P=(0,s.PH)(d("Load Photos To Moderate")),_=(0,s.PH)(d("Load Photos To Moderate Success","api"),(0,s.Ky)()),C=(0,s.PH)(d("Load Photos To Moderate Failure","api"),(0,s.Ky)()),S=(0,s.PH)(d("Approve Photo To Moderate","page"),(0,s.Ky)()),I=(0,s.PH)(d("Approve Photo To Moderate Success","api"),(0,s.Ky)()),x=(0,s.PH)(d("Approve Photo To Moderate Failure","api"),(0,s.Ky)()),L=(0,s.PH)(d("Reject Photo To Moderate","page"),(0,s.Ky)()),q=(0,s.PH)(d("Reject Photo To Moderate Success","api"),(0,s.Ky)()),K=(0,s.PH)(d("Reject Photo To Moderate Failure","api"),(0,s.Ky)());var tt=r(6293);const Q="admin",F=(0,tt.H)({selectId:e=>e.id}),et=F.getInitialState({loaded:!1,loading:0}),ot=(0,s.Lq)(et,(0,s.on)(b,e=>({...e,loaded:!1,loading:e.loading+1,error:void 0})),(0,s.on)(E,(e,{users:i})=>F.setAll(i,{...e,loaded:!0,loading:e.loading-1})),(0,s.on)(Z,(e,{error:i})=>({...e,loading:e.loading-1,error:i})),(0,s.on)(R,e=>({...e,loading:e.loading+1,error:void 0})),(0,s.on)(k,(e,{user:i})=>F.updateOne({id:i.id,changes:{roles:i.roles}},{...e,loading:e.loading-1})),(0,s.on)($,(e,{error:i})=>({...e,loading:e.loading-1,error:i})),(0,s.on)(P,e=>({...e,loading:e.loading+1,error:void 0,photosToModerate:void 0})),(0,s.on)(_,(e,{photosToModerate:i})=>({...e,loading:e.loading-1,photosToModerate:i})),(0,s.on)(C,(e,{error:i})=>({...e,loading:e.loading-1,error:i})),(0,s.on)(S,e=>({...e,loading:e.loading+1,error:void 0})),(0,s.on)(I,(e,{photosToModerate:i})=>({...e,loading:e.loading-1,photosToModerate:i})),(0,s.on)(x,(e,{error:i})=>({...e,loading:e.loading-1,error:i})),(0,s.on)(L,e=>({...e,loading:e.loading+1,error:void 0})),(0,s.on)(q,(e,{photosToModerate:i})=>({...e,loading:e.loading-1,photosToModerate:i})),(0,s.on)(K,(e,{error:i})=>({...e,loading:e.loading-1,error:i}))),v=(0,s.ZF)(Q),{selectAll:st}=F.getSelectors(),nt=(0,s.P1)(v,e=>e.loaded),it=(0,s.P1)(v,e=>e.loading>0),rt=(0,s.P1)(v,e=>e.error),O=(0,s.P1)(v,e=>e.photosToModerate),at=(0,s.P1)(v,e=>st(e));let H=(()=>{class e{constructor(o){this.store=o,this.loaded$=this.store.pipe((0,s.Ys)(nt)),this.loading$=this.store.pipe((0,s.Ys)(it)),this.error$=this.store.pipe((0,s.Ys)(rt)),this.photosToModerate$=this.store.pipe((0,s.Ys)(O)),this.allUsers$=this.store.pipe((0,s.Ys)(at))}init(){this.store.dispatch(b())}updateUserRoles(o){this.store.dispatch(R({user:o}))}approvePhotoToModerate(o){this.store.dispatch(S({photoToModerate:o}))}rejectPhotoToModerate(o){this.store.dispatch(L({photoToModerate:o}))}static#t=this.\u0275fac=function(n){return new(n||e)(t.LFG(s.yh))};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac})}return e})();const ct=["Member","Admin","Moderator"];var m=r(6814),p=r(5154),V=r(9862),lt=r(553);let z=(()=>{class e{constructor(o){this.http=o,this.apiUrl=lt.N.apiUrl}getUsersWithRole(){return this.http.get(this.apiUrl+"Admin/users-with-roles")}updateUserRoles(o){const n=this.apiUrl+"Admin/edit-roles/"+o.username;let a=(new V.LE).append("roles",o.roles.join(","));return this.http.post(n,{},{params:a})}getPhotosToModerate(){return this.http.get(this.apiUrl+"Admin/photos-to-moderate")}approvePhoto(o){return this.http.put(this.apiUrl+"Admin/approve-photo/"+o,{})}removePhoto(o){return this.http.delete(this.apiUrl+"Admin/remove-photo/"+o)}static#t=this.\u0275fac=function(n){return new(n||e)(t.LFG(V.eN))};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac})}return e})();var Y=r(2460),f=r(4664),U=r(7398),M=r(6306),T=r(2096),dt=r(9397),j=r(1367),pt=r(9600);let ht=(()=>{class e{constructor(o,n,a,l,g){this.actions$=o,this.store=n,this.api=a,this.sessionService=l,this.errorService=g,this.init$=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(b),(0,Y.M)(this.sessionService.userRoles$),(0,f.w)(([c,h])=>h.includes("Admin")?[W(),P()]:h.includes("Moderator")?[P()]:[]))),this.loadUsersWithRole$=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(W),(0,f.w)(()=>this.api.getUsersWithRole().pipe((0,U.U)(c=>E({users:c})),(0,M.K)(c=>(0,T.of)(Z({error:this.errorService.getErrorMessage(c)}))))))),this.updateUser$=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(R),(0,f.w)(({user:c})=>this.api.updateUserRoles({username:c.username,roles:c.roles}).pipe((0,U.U)(u=>k({user:{...c,roles:u}})),(0,M.K)(u=>(0,T.of)($({error:this.errorService.getErrorMessage(u)}))))))),this.loadPhotosToModerate$=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(P),(0,f.w)(()=>this.api.getPhotosToModerate().pipe((0,U.U)(c=>_({photosToModerate:c.map(h=>({id:h.id,username:h.username,url:h.url}))})),(0,M.K)(c=>(0,T.of)(C({error:this.errorService.getErrorMessage(c)}))))))),this.approvePhotoToModerate$=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(S),(0,Y.M)(this.store.pipe((0,s.Ys)(O))),(0,f.w)(([{photoToModerate:c},h])=>this.api.approvePhoto(c.id).pipe((0,U.U)(()=>I({photosToModerate:h?.filter(u=>u.id!==c.id)??[]})),(0,M.K)(u=>(0,T.of)(x({error:this.errorService.getErrorMessage(u)}))))))),this.rejectPhotoToModerate$=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(L),(0,Y.M)(this.store.pipe((0,s.Ys)(O))),(0,f.w)(([{photoToModerate:c},h])=>this.api.removePhoto(c.id).pipe((0,U.U)(()=>q({photosToModerate:h?.filter(u=>u.id!==c.id)??[]})),(0,M.K)(u=>(0,T.of)(K({error:this.errorService.getErrorMessage(u)}))))))),this.genericError$=(0,p.GW)(()=>this.actions$.pipe((0,p.l4)(Z,$,C,x,K),(0,dt.b)(({error:c})=>this.errorService.handleError(c))),{dispatch:!1})}static#t=this.\u0275fac=function(n){return new(n||e)(t.LFG(p.eX),t.LFG(s.yh),t.LFG(z),t.LFG(j.o6),t.LFG(pt.T))};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac})}return e})(),ut=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=t.oAB({type:e});static#o=this.\u0275inj=t.cJS({providers:[z,H],imports:[m.ez,s.Aw.forFeature(Q,ot),p.sQ.forFeature([ht])]})}return e})();var B=r(9280),w=r(285);function mt(e,i){1&e&&t._UZ(0,"app-util-loader")}function gt(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"div",3)(1,"div",4),t._UZ(2,"img",5),t.TgZ(3,"div",6)(4,"h5",7),t._uU(5),t.qZA(),t.TgZ(6,"div",8)(7,"button",9),t.NdJ("click",function(){const l=t.CHM(o).$implicit,g=t.oxw();return t.KtG(g.approve(l))}),t._uU(8," Approve "),t.qZA(),t.TgZ(9,"button",10),t.NdJ("click",function(){const l=t.CHM(o).$implicit,g=t.oxw();return t.KtG(g.reject(l))}),t._uU(10," Reject "),t.qZA()()()()()}if(2&e){const o=i.$implicit;t.xp6(2),t.s9C("src",o.url,t.LSH),t.MGl("alt","Photo from ",o.username,""),t.xp6(3),t.Oqu(o.username)}}let ft=(()=>{class e{constructor(o,n){this.adminFacade=o,this.userFacade=n,this.loading$=this.adminFacade.loading$,this.photos$=this.adminFacade.photosToModerate$,this.mainPhotoUpdated=!1}ngOnDestroy(){this.mainPhotoUpdated&&this.userFacade.init()}approve(o){this.adminFacade.approvePhotoToModerate(o),this.userFacade.allUsers$.pipe((0,N.q)(1)).subscribe(n=>{const a=n.find(l=>l.userName===o.username);!a||a.photoUrl||(this.mainPhotoUpdated=!0)})}reject(o){this.adminFacade.rejectPhotoToModerate(o)}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(H),t.Y36(B.K))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-photo-management"]],decls:5,vars:6,consts:[[4,"ngIf"],[1,"row","m-3"],["class","col-2",4,"ngFor","ngForOf"],[1,"col-2"],[1,"card"],[1,"card-img-top","img-thumbnail",3,"src","alt"],[1,"card-body","text-center"],[1,"card-title"],[1,"row"],[1,"btn","btn-sm","btn-success","col-6",3,"click"],[1,"btn","btn-sm","btn-danger","col-6",3,"click"]],template:function(n,a){1&n&&(t.YNc(0,mt,1,0,"app-util-loader",0),t.ALo(1,"async"),t.TgZ(2,"div",1),t.YNc(3,gt,11,3,"div",2),t.ALo(4,"async"),t.qZA()),2&n&&(t.Q6J("ngIf",t.lcZ(1,2,a.loading$)),t.xp6(3),t.Q6J("ngForOf",t.lcZ(4,4,a.photos$)))},dependencies:[m.sg,m.O5,w.I,m.Ov]})}return e})();var Ut=r(8645),J=r(2051),A=r(95);function Mt(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"div",11)(1,"input",12),t.NdJ("change",function(){const l=t.CHM(o).$implicit,g=t.oxw();return t.KtG(g.check(l))}),t.qZA(),t.TgZ(2,"label"),t._uU(3),t.qZA()()}if(2&e){const o=i.$implicit,n=t.oxw();t.xp6(1),t.Q6J("checked",n.selectedRoles.includes(o))("disabled","Admin"===o&&"admin"===n.username),t.xp6(2),t.Oqu(o)}}let Tt=(()=>{class e{constructor(o){this.modalRef=o,this.username="",this.selectedRoles=[],this.availableRoles=Object.values(ct),this.submitSubj=new Ut.x,this.submit$=this.submitSubj.asObservable()}ngOnDestroy(){this.submitSubj.complete()}check(o){this.selectedRoles.includes(o)?this.selectedRoles=this.selectedRoles.filter(n=>n!==o):this.selectedRoles.push(o)}submit(){this.submitSubj.next(this.selectedRoles),this.close()}close(){this.modalRef.hide()}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(J.UZ))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-user-roles-modal"]],decls:15,vars:2,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],["id","rolesForm"],["rolesForm","ngForm"],["class","form-check",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"form-check"],["type","checkbox","value","role",1,"form-check-input",3,"checked","disabled","change"]],template:function(n,a){1&n&&(t.TgZ(0,"div",0)(1,"h4",1),t._uU(2),t.qZA(),t.TgZ(3,"button",2),t.NdJ("click",function(){return a.close()}),t.TgZ(4,"span",3),t._uU(5,"\xd7"),t.qZA()()(),t.TgZ(6,"div",4)(7,"form",5,6),t.YNc(9,Mt,4,3,"div",7),t.qZA()(),t.TgZ(10,"div",8)(11,"button",9),t.NdJ("click",function(){return a.submit()}),t._uU(12,"Submit"),t.qZA(),t.TgZ(13,"button",10),t.NdJ("click",function(){return a.close()}),t._uU(14,"Close"),t.qZA()()),2&n&&(t.xp6(2),t.hij("Edit Roles for ",a.username,""),t.xp6(7),t.Q6J("ngForOf",a.availableRoles))},dependencies:[m.sg,A._Y,A.JL,A.F]})}return e})();function Pt(e,i){1&e&&t._UZ(0,"app-util-loader")}function Ft(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td")(6,"button",6),t.NdJ("click",function(){const l=t.CHM(o).$implicit,g=t.oxw();return t.KtG(g.openRolesModal(l))}),t._uU(7," Edit roles "),t.qZA()()()}if(2&e){const o=i.$implicit;t.xp6(2),t.Oqu(o.username),t.xp6(2),t.Oqu(o.roles)}}let At=(()=>{class e{constructor(o,n){this.adminFacade=o,this.modalService=n,this.loading$=this.adminFacade.loading$,this.users$=this.adminFacade.allUsers$}ngOnInit(){this.adminFacade.init()}openRolesModal(o){const n={username:o.username,selectedRoles:[...o.roles]};this.modalService.show(Tt,{class:"modal-dialog-centered",initialState:n}).content?.submit$.pipe((0,N.q)(1)).subscribe(l=>{(function vt(e,i){return JSON.stringify(e.sort())===JSON.stringify(i.sort())})([...o.roles],l)||this.adminFacade.updateUserRoles({...o,roles:l})})}trackByFn(o,n){return n.id}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(H),t.Y36(J.tT))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-user-management"]],decls:14,vars:7,consts:[[4,"ngIf"],[1,"row"],[1,"table"],[1,"w-30"],[1,"w-40"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"btn","btn-info",3,"click"]],template:function(n,a){1&n&&(t.YNc(0,Pt,1,0,"app-util-loader",0),t.ALo(1,"async"),t.TgZ(2,"div",1)(3,"table",2)(4,"thead")(5,"tr")(6,"th",3),t._uU(7,"Username"),t.qZA(),t.TgZ(8,"th",4),t._uU(9,"Active roles"),t.qZA(),t._UZ(10,"th",3),t.qZA()(),t.TgZ(11,"tbody"),t.YNc(12,Ft,8,2,"tr",5),t.ALo(13,"async"),t.qZA()()()),2&n&&(t.Q6J("ngIf",t.lcZ(1,3,a.loading$)),t.xp6(12),t.Q6J("ngForOf",t.lcZ(13,5,a.users$))("ngForTrackBy",a.trackByFn))},dependencies:[m.sg,m.O5,w.I,m.Ov],styles:[".w-30[_ngcontent-%COMP%]{width:30%}.w-40[_ngcontent-%COMP%]{width:40%}"]})}return e})();function yt(e,i){1&e&&(t.TgZ(0,"tab",5)(1,"div",0),t._UZ(2,"app-user-management"),t.qZA()())}function bt(e,i){1&e&&(t.TgZ(0,"tab",6)(1,"div",0),t._UZ(2,"app-photo-management"),t.qZA()())}const Zt=function(){return["Admin"]},Rt=function(){return["Admin","Moderator"]};let D=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-view-admin"]],decls:7,vars:4,consts:[[1,"container"],[1,"tab-panel"],[1,"member-tabset"],["heading","User Management",4,"appForRoles"],["heading","Photo Management",4,"appForRoles"],["heading","User Management"],["heading","Photo Management"]],template:function(n,a){1&n&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2,"Admin Panel"),t.qZA(),t.TgZ(3,"div",1)(4,"tabset",2),t.YNc(5,yt,3,0,"tab",3),t.YNc(6,bt,3,0,"tab",4),t.qZA()()()),2&n&&(t.xp6(5),t.Q6J("appForRoles",t.DdM(2,Zt)),t.xp6(1),t.Q6J("appForRoles",t.DdM(3,Rt)))},dependencies:[y.wW,y.AH,X.d,ft,At]})}return e})();var $t=r(2236);let Ct=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=t.oAB({type:e});static#o=this.\u0275inj=t.cJS({providers:[j.o6],imports:[m.ez,A.u5,$t.Bz.forChild([{path:"",component:D}]),J.zk.forRoot(),y.P4.forRoot(),j.Vd,w.I,B._,ut]})}return e})()}}]);